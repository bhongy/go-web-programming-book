# Postgres - Managing Tables

## Create Table

```sql
CREATE TABLE [IF NOT EXISTS] table_name (
   column1 datatype(length) column_contraint,
   column2 datatype(length) column_contraint,
   column3 datatype(length) column_contraint,
   table_constraints
);

-- column_constraint:
--   NOT NULL
--   UNIQUE
--   PRIMARY KEY . a table can have only one primary key
--   CHECK
--   FOREIGN KEY . ensure the value existed in a column (or a group of columns) in another table, a table can have multiple foreign keys

CREATE TABLE accounts (
	user_id SERIAL PRIMARY KEY,
	username VARCHAR ( 50 ) UNIQUE NOT NULL,
	password VARCHAR ( 50 ) NOT NULL,
	email VARCHAR ( 255 ) UNIQUE NOT NULL,
	created_on TIMESTAMP NOT NULL,
	last_login TIMESTAMP 
);

CREATE TABLE roles(
   role_id SERIAL PRIMARY KEY,
   role_name VARCHAR (255) UNIQUE NOT NULL
);

CREATE TABLE account_roles (
  user_id INT NOT NULL,
  role_id INT NOT NULL,
  grant_date TIMESTAMP,
  PRIMARY KEY (user_id, role_id),
  FOREIGN KEY (role_id)
      REFERENCES roles (role_id),
  FOREIGN KEY (user_id)
      REFERENCES accounts (user_id)
);
```

### CREATE TABLE AS

Create a new table and insert data returned from a query into the table.

```sql
CREATE TABLE action_film AS
SELECT
   film_id,
   title,
   release_year,
   length,
   rating
FROM
   film
INNER JOIN film_category USING (film_id)
WHERE
   category_id = 1;

CREATE TABLE IF NOT EXISTS film_rating (rating, film_count) AS 
SELECT
   rating,
   COUNT (film_id)
FROM
   film
GROUP BY
   rating;
```

### SERIAL

- pseudo-type: auto increment column (a sequence)
- `NOT NULL` is implied (do not need to add)
- does not create an index or make the column the primary key

```sql
CREATE TABLE fruits(
   id SERIAL PRIMARY KEY,
   name VARCHAR NOT NULL
);
```

### GENERATED AS IDENTITY

- Better alternative (SQL standard-conforming) than `SERIAL`
- Available in PostgreSQL v10+

```sql
CREATE TABLE color (
    id INT GENERATED ALWAYS AS IDENTITY,
    name VARCHAR NOT NULL
);

CREATE TABLE color (
    id INT GENERATED BY DEFAULT AS IDENTITY
      -- sequence options
      (START WITH 10 INCREMENT BY 10),
    color_name VARCHAR NOT NULL
); 
```

- `GENERATED ALWAYS` error if attempting to insert (or update) values into the `GENERATED ALWAYS AS IDENTITY` column
- `GENERATED BY DEFAULT` use the supplies value if provided otherwise use the sequence

## Alter Table

https://www.postgresqltutorial.com/postgresql-alter-table/

## Truncate Table

Delete **all** data from a table (faster than `DELETE` because it doesn't scan the data first) as well as reclaim the storage right away without needing to run `VACUMN`.
